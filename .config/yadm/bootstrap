#!/bin/bash
# yadm bootstrap script - sets up OS-specific symlinks

set -e

echo "Running yadm bootstrap..."

# Determine OS-specific paths
if [[ "$OSTYPE" == "darwin"* ]]; then
    VSCODE_DIR="$HOME/Library/Application Support/Code/User"
    CURSOR_DIR="$HOME/Library/Application Support/Cursor/User"
else
    # Linux
    VSCODE_DIR="$HOME/.config/Code/User"
    CURSOR_DIR="$HOME/.config/Cursor/User"
fi

# VSCode settings
if [[ -f "$HOME/.config/yadm/files/vscode-settings.json" ]]; then
    mkdir -p "$VSCODE_DIR"
    # Backup existing if not a symlink
    if [[ -f "$VSCODE_DIR/settings.json" && ! -L "$VSCODE_DIR/settings.json" ]]; then
        mv "$VSCODE_DIR/settings.json" "$VSCODE_DIR/settings.json.bak"
        echo "Backed up existing VSCode settings to settings.json.bak"
    fi
    ln -sf "$HOME/.config/yadm/files/vscode-settings.json" "$VSCODE_DIR/settings.json"
    echo "Linked VSCode settings"
fi

# Cursor settings
if [[ -f "$HOME/.config/yadm/files/cursor-settings.json" ]]; then
    mkdir -p "$CURSOR_DIR"
    # Backup existing if not a symlink
    if [[ -f "$CURSOR_DIR/settings.json" && ! -L "$CURSOR_DIR/settings.json" ]]; then
        mv "$CURSOR_DIR/settings.json" "$CURSOR_DIR/settings.json.bak"
        echo "Backed up existing Cursor settings to settings.json.bak"
    fi
    ln -sf "$HOME/.config/yadm/files/cursor-settings.json" "$CURSOR_DIR/settings.json"
    echo "Linked Cursor settings"
fi

echo "Bootstrap complete!"
