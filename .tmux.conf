# ======================
# Prefix Key: Ctrl+Space
# ======================
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# ======================
# General Settings
# ======================
set -g mouse on                    # Enable mouse support
set -g base-index 1                # Start windows at 1, not 0
setw -g pane-base-index 1          # Start panes at 1
set -g renumber-windows on         # Renumber windows when one is closed
set -g history-limit 10000         # Scrollback buffer
set -g escape-time 0               # No delay for escape key

# ======================
# Pane Borders & Labels
# ======================
# Show pane title at bottom - ACTIVE pane gets highlighted label
set -g pane-border-status bottom
set -g pane-border-format '#{?pane_active,#[fg=#1e1e2e]#[bg=#89b4fa]#[bold] #P: #{pane_title} #[default],#[fg=#6c7086] #P: #{pane_title} }'

# Border colors - bright blue for active, dim for inactive
set -g pane-border-style 'fg=#45475a'
set -g pane-active-border-style 'fg=#89b4fa'

# ======================
# Clipboard (macOS)
# ======================
set -g set-clipboard on
setw -g mode-keys vi               # Use vim keys in copy mode

# Enter copy mode: prefix + [
# Select with v, yank with y
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

# Mouse selection copies to system clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "pbcopy"

# Paste from system clipboard: prefix + p
bind p run "pbpaste | tmux load-buffer - && tmux paste-buffer"

# ======================
# Easy Window/Pane Creation
# ======================
bind c new-window -c "#{pane_current_path}"      # New window in current dir
bind | split-window -h -c "#{pane_current_path}" # Split horizontal
bind - split-window -v -c "#{pane_current_path}" # Split vertical

# ======================
# Navigation (Vim-style)
# ======================
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Quick pane switch
bind -n C-\\ select-pane -t +       # Ctrl+\ = cycle panes (no prefix)
bind 1 select-pane -t 1             # prefix+1 = pane 1 (claude-code)
bind 2 select-pane -t 2             # prefix+2 = pane 2 (terminal)
bind 3 select-pane -t 3             # prefix+3 = pane 3 (pymol)

# ======================
# Session Management
# ======================
bind S command-prompt -p "New session name:" "new-session -s '%%'"
bind K confirm-before -p "Kill session #S? (y/n)" kill-session
bind s choose-tree -sZ                # Session picker (interactive)
bind w choose-tree -wZ                # Window picker (interactive)

# ======================
# Quick Session Switching
# ======================
bind ( switch-client -p              # Previous session
bind ) switch-client -n              # Next session

# ======================
# Reload Config
# ======================
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# ======================
# Status Bar
# ======================
set -g status-position bottom
set -g status-style 'bg=#1e1e2e fg=#cdd6f4'
set -g status-left-length 40
set -g status-right-length 60

# Left: Session name (turns RED when prefix is active)
set -g status-left '#{?client_prefix,#[fg=#1e1e2e]#[bg=#f38ba8]#[bold] #S #[default] ,#[fg=#1e1e2e]#[bg=#89b4fa]#[bold] #S #[default] }'

# Right: Window count + Date/Time
set -g status-right '#[fg=#a6adc8] #I/#(tmux list-windows | wc -l | tr -d " ") wins #[fg=#1e1e2e,bg=#a6e3a1,bold] %H:%M '

# Window status
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format '#[fg=#1e1e2e,bg=#f9e2af,bold] #I:#W #[fg=#f9e2af,bg=default]'

# ======================
# Plugins (via TPM)
# ======================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'   # Save/restore sessions

# Resurrect settings
set -g @resurrect-capture-pane-contents 'on'

# Initialize TPM (keep this at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
